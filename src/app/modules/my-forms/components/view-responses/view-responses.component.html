<mat-toolbar color="primary" class="nav-bar">
  <div class="logo">
    <a routerLink="/" aria-label="Home">FormSphere</a>
  </div>
  <div class="nav">
    <ul>
      <li>
        <a mat-button routerLink="/templates" aria-label="Templates"
          >Templates</a
        >
      </li>
      <li>
        <a mat-button routerLink="/create-form" aria-label="Create Form"
          >Create Form</a
        >
      </li>
      <li>
        <a mat-button routerLink="/my-forms" aria-label="My Forms">My Forms</a>
      </li>
      <li>
        <a
          mat-button
          routerLink="/analytics/{{ formId }}"
          aria-label="Analytics"
          >Analytics</a
        >
      </li>
    </ul>
  </div>
  <button
    mat-stroked-button
    aria-label="LogOut button"
    class="logout"
    (click)="logoutUser()"
  >
    Logout
  </button>
</mat-toolbar>

<!-- Search Bar, Page Size, and Sort Controls -->
<div class="search-container">
  <input
    type="text"
    class="search-input"
    placeholder="Search by name or email..."
    [(ngModel)]="searchInput"
    (ngModelChange)="onSearchInputChange($event)"
    aria-label="Search"
    [ngStyle]="{
      'background-color': formStyling?.pageColor,
      color: formStyling?.fontColor,
      'font-family': formStyling?.fontFamily || 'Montserrat',
      border: '1px solid ' + formStyling?.fontColor,
    }"
  />
  <select
    class="page-size-select"
    [(ngModel)]="pageSize"
    (change)="onPageSizeChange($event)"
    [ngStyle]="{
      'background-color': formStyling?.pageColor,
      color: formStyling?.fontColor,
      'font-family': formStyling?.fontFamily || 'Montserrat',
      border: '1px solid ' + formStyling?.fontColor,
    }"
  >
    <option *ngFor="let size of pageSizes" [value]="size">
      {{ size }} / page
    </option>
  </select>
  <div class="sort-bar">
    <label for="sortBy">Sort by:</label>
    <select
      id="sortBy"
      class="sort-select"
      [(ngModel)]="sortBy"
      (change)="onSortByChange($event)"
      [ngStyle]="{
        'background-color': formStyling?.pageColor,
        color: formStyling?.fontColor,
        'font-family': formStyling?.fontFamily || 'Montserrat',
        border: '1px solid ' + formStyling?.fontColor,
      }"
    >
      <option *ngFor="let opt of sortOptions" [value]="opt.value">
        {{ opt.label }}
      </option>
    </select>
    <button
      mat-icon-button
      class="sort-order-btn"
      (click)="onSortOrderChange()"
      [attr.aria-label]="'Sort ' + sortOrder"
      [ngStyle]="{
        'background-color': formStyling?.pageColor,
        color: formStyling?.fontColor,
        'font-family': formStyling?.fontFamily || 'Montserrat',
      }"
    >
      <mat-icon>{{
        sortOrder === 'asc' ? 'arrow_upward' : 'arrow_downward'
      }}</mat-icon>
    </button>
  </div>
</div>

<!-- Responses container -->
<div
  class="responses-container"
  [ngStyle]="{
    'background-color': formStyling?.pageColor,
    color: formStyling?.fontColor,
    'font-family': formStyling?.fontFamily || 'Montserrat',
    'font-size.px': formStyling?.fontSize || 16,
  }"
>
  <h1
    [ngStyle]="{
      color: formStyling?.fontColor,
      'font-family': formStyling?.fontFamily || 'Montserrat',
    }"
  >
    Responses
  </h1>

  <div
    *ngIf="responses.length === 0"
    class="no-responses"
    [ngStyle]="{
      color: formStyling?.fontColor,
      'font-family': formStyling?.fontFamily || 'Montserrat',
    }"
  >
    <p>No responses available for this form.</p>
  </div>

  <div *ngIf="responses.length > 0" class="forms-list">
    <div
      *ngFor="let response of responses"
      class="response-card"
      [ngStyle]="{
        'background-color': formStyling?.formColor || '#fff',
      }"
    >
      <h2
        [ngStyle]="{
          color: formStyling?.fontColor,
          'font-family': formStyling?.fontFamily || 'Montserrat',
        }"
      >
        User: {{ response.userName }} ({{ response.userEmail }})
      </h2>
      <p
        [ngStyle]="{
          color: formStyling?.formColor === '#444444' ? '#fff' : '#444',
        }"
      >
        Submitted on: {{ response.createdAt | date: 'medium' }}
      </p>

      <div class="form-preview">
        <ng-container *ngFor="let answer of response.answers">
          <ng-container [ngSwitch]="answer.questionType">
            <!-- Heading -->
            <h1
              *ngSwitchCase="'heading'"
              class="form-header"
              [ngStyle]="{
                color: formStyling?.fontColor,
                'font-family': formStyling?.fontFamily || 'Montserrat',
              }"
            >
              {{ answer.questionText }}
            </h1>

            <!-- File -->
            <div *ngSwitchCase="'file'" class="form-field">
              <p
                class="question-text"
                [ngStyle]="{
                  color: formStyling?.fontColor,
                  'font-family': formStyling?.fontFamily || 'Montserrat',
                }"
              >
                {{ answer.questionText }}
              </p>
              <a
                href="#"
                (click)="
                  downloadFile(answer.responseAnswer); $event.preventDefault()
                "
                [ngStyle]="{
                  color: formStyling?.formColor === '#444444' ? '#fff' : '#444',
                }"
              >
                Download File
              </a>
            </div>

            <!-- Signature -->
            <div *ngSwitchCase="'signature'" class="form-field">
              <p
                class="question-text"
                [ngStyle]="{
                  color: formStyling?.fontColor,
                  'font-family': formStyling?.fontFamily || 'Montserrat',
                }"
              >
                {{ answer.questionText }}
              </p>
              <img
                [src]="answer.responseAnswer"
                alt="Signature"
                class="signature-preview"
              />
            </div>

            <!-- Default -->
            <div *ngSwitchDefault class="form-field">
              <p
                class="question-text"
                [ngStyle]="{
                  color: formStyling?.fontColor,
                  'font-family': formStyling?.fontFamily || 'Montserrat',
                }"
              >
                {{ answer.questionText }}
              </p>
              <p
                [ngStyle]="{
                  color: formStyling?.formColor === '#444444' ? '#fff' : '#444',
                }"
              >
                {{ answer.responseAnswer }}
              </p>
            </div>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- Pagination Controls -->
  <div class="pagination-container" *ngIf="totalPages">
    <button
      mat-stroked-button
      (click)="onPageChange(page - 1)"
      [disabled]="page === 1"
      [ngStyle]="{
        color: formStyling?.fontColor,
        'font-family': formStyling?.fontFamily || 'Montserrat',
        border: '1px solid ' + formStyling?.fontColor,
      }"
    >
      &lt; Prev
    </button>
    <ng-container *ngFor="let p of pageNumbers">
      <button
        mat-stroked-button
        [color]="p === page ? 'primary' : ''"
        (click)="onPageChange(p)"
        [ngStyle]="{
          color: formStyling?.fontColor,
          'font-family': formStyling?.fontFamily || 'Montserrat',
          border: '1px solid ' + formStyling?.fontColor,
        }"
      >
        {{ p }}
      </button>
    </ng-container>
    <button
      mat-stroked-button
      (click)="onPageChange(page + 1)"
      [disabled]="page === totalPages"
      [ngStyle]="{
        color: formStyling?.fontColor,
        'font-family': formStyling?.fontFamily || 'Montserrat',
        border: '1px solid ' + formStyling?.fontColor,
      }"
    >
      Next &gt;
    </button>
    <span
      class="pagination-info"
      [ngStyle]="{
        color: formStyling?.fontColor,
        'font-family': formStyling?.fontFamily || 'Montserrat',
      }"
      >Page {{ page }} of {{ totalPages }}</span
    >
  </div>
</div>
